# Stage 1
FROM node:22-alpine AS frontend-builder

WORKDIR /app
COPY frontend/package*.json frontend/vite.config.ts frontend/tsconfig.json frontend/tsconfig.node.json ./
RUN npm ci
COPY frontend ./
RUN npm run build

# Stage 2
FROM node:22-alpine

RUN apk add --no-cache gettext
WORKDIR /app
COPY --from=frontend-builder /app/dist ./dist
COPY --from=frontend-builder /app/node_modules ./node_modules
COPY frontend/package*.json frontend/vite.config.ts frontend/tsconfig.json frontend/tsconfig.node.json ./
COPY docker-entrypoint.sh /docker-entrypoint.sh
RUN chmod +x /docker-entrypoint.sh
EXPOSE 4173
ENTRYPOINT ["/docker-entrypoint.sh"]
